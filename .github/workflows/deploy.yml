name: Build and Deploy
env:
  CI: false
  GITHUB_USERNAME: ${{ github.repository_owner }}
  REACT_APP_GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  USE_GITHUB_DATA: "true"
  MEDIUM_USERNAME: "saadpasta"
on:
  workflow_dispatch:
  push:
    branches:
      - master
      - main
  schedule:
    - cron: "0 12 * * 1"

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Setup Node.js üîß
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Install and Build üîß
        run: |
          # Show versions for debugging
          node -v
          npm -v

          # Try a clean install first, fall back to npm install if needed
          npm ci --prefer-offline --no-audit || npm install --prefer-offline --no-audit

          # Debug: List installed packages
          echo "Installed packages:"
          npm list --depth=0

          # Debug: Check if react-scripts is available
          echo "Checking for react-scripts:"
          npx which react-scripts || echo "react-scripts not found in PATH"
          ls -la node_modules/.bin/ || true

          # Run the build
          npm run build

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          repository-name: prithwish-rgb/Developer-folio
          branch: gh-pages
          folder: build
          clean: true
          clean-exclude: |
            CNAME
            .nojekyll
            .gitignore
          commit-message: "Deploy: ${{ github.sha }}"
          target-folder: /